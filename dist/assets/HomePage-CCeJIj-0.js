import{u as P,d as A,j as t,B as i,P as B,a as f,b as D,c as T,r as c,T as l,S as k,e as C,f as E,i as j,g as R,M as L,L as h}from"./index-BvvL1rGo.js";import{s as u}from"./Toast-B5XXwoML.js";import"./html5-qrcode-scanner-QyajDaF6.js";import{S as M}from"./Stack-BgDWLZld.js";function g(e){const s=P.getState().localTimeZone,n=A.tz(e,"UTC").tz(s);return n.isValid()?n.format("DD.MM.YYYY"):""}const y=({children:e,sx:s,...n})=>t.jsx(i,{sx:{flex:1,display:"flex",flexDirection:"column",gap:1,overflowX:"auto",...s},...n,children:e}),w=({children:e,sx:s,...n})=>t.jsx(B,{elevation:0,sx:{display:"flex",alignItems:"center",p:1,pl:2,borderRadius:r=>r.shape.borderRadius,transition:r=>r.transitions.create("background-color"),"&:hover":{backgroundColor:"action.hover"},...s},...n,children:e}),p=({amount:e,sx:s,...n})=>t.jsx(f,{label:e?`${e.toLocaleString()} ₽`:"0",icon:e?e>0?"ArrowUpwardIcon":"ArrowDownwardIcon":void 0,sx:{backgroundColor:r=>e&&e>0?r.palette.success.light:e&&e<0?r.palette.error.light:"transparent",color:r=>e&&e>0?r.palette.success.contrastText:e&&e<0?r.palette.error.contrastText:r.palette.text.primary,fontWeight:e?"bold":"normal",borderRadius:r=>r.shape.borderRadius,padding:r=>r.spacing(.5,1.5),textTransform:"none",boxShadow:e!==0?void 0:"none","&:hover":{backgroundColor:r=>e&&e>0?r.palette.success.main:e&&e<0?r.palette.error.main:"action.hover",boxShadow:e!==0?void 0:"none"},...s},...n}),O=({open:e,anchorEl:s,onClose:n,children:r,...o})=>t.jsx(D,{id:e?"simple-popover":void 0,"aria-hidden":!e,open:e,anchorEl:s,onClose:n,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{p:2,mt:1,borderRadius:T}}},...o,children:r}),m=({amount:e,getData:s,loading:n,children:r})=>{const[o,a]=c.useState(null),d=!!o,x=async I=>{const S=I.currentTarget;await s(),a(S)};return t.jsxs(t.Fragment,{children:[t.jsx(p,{amount:e,isLoading:n,onClick:x}),t.jsx(O,{open:d,anchorEl:o,onClose:()=>a(null),children:r})]})},b=()=>t.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx(l,{variant:"h6",children:"Нет данных"})}),G=({count:e=5,itemHeight:s=40})=>t.jsx(i,{children:Array.from(new Array(e)).map((n,r)=>t.jsx(k,{variant:"text",height:s,sx:{my:1}},r))});function W(){const{data:e,error:s,...n}=C();return c.useEffect(()=>{s&&u("Ошибка при загрузке статистики",s)},[s]),{...n,data:e?.personsWithStatistics??[],error:s}}const z=e=>{const[s,{data:n,error:r,loading:o}]=E({variables:{personId:e}});return c.useEffect(()=>{r&&u("Ошибка при загрузке списка приходов",r)},[r]),{getInflows:s,data:n?.inflowsByPersonId??[],loading:o,error:r}};function v({data:e,fields:s,title:n}){return j(e)?t.jsx(b,{}):t.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1,maxHeight:"55vh"},children:[n&&t.jsx(l,{variant:"h6",sx:{flexShrink:0},children:n}),t.jsx(y,{sx:{display:"table"},children:e.map(r=>t.jsx(w,{sx:{display:"table-row","& > .MuiTypography-root":{display:"table-cell",padding:o=>o.spacing(1,2),borderRight:o=>`1px solid ${o.palette.divider}`,textAlign:"center",verticalAlign:"middle"},"& > .MuiTypography-root:last-child":{borderRight:"none"}},children:s.map(({render:o},a)=>t.jsx(l,{variant:"body1",sx:{"& > *":{width:"100%"}},children:o(r)},a))},r.id))})]})}const H=[{render:e=>e.person.name},{render:e=>e.facility.name},{render:e=>e.job.name},{render:e=>t.jsx(p,{amount:e.amount})},{render:e=>g(e.date)}],Y=({data:e})=>t.jsx(v,{data:e,fields:H,title:"Приходы"}),F=({id:e,amount:s})=>{const{getInflows:n,data:r,loading:o}=z(e);return t.jsx(m,{amount:s,loading:o,getData:n,children:t.jsx(Y,{data:r})})},Q=e=>{const[s,{data:n,error:r,loading:o}]=R({variables:{personId:e}});return c.useEffect(()=>{r&&u("Ошибка при загрузке списка расходов",r)},[r]),{getOutflow:s,data:n?.outflowsByPersonId??[],loading:o,error:r}},U=[{render:e=>e.person.name},{render:e=>e.facility.name},{render:e=>t.jsx(p,{amount:-e.amount})},{render:e=>g(e.date)}],Z=({data:e})=>t.jsx(v,{data:e,fields:U,title:"Расходы"}),_=({id:e,amount:s})=>{const{getOutflow:n,data:r,loading:o}=Q(e);return t.jsx(m,{amount:s,loading:o,getData:n,children:t.jsx(Z,{data:r})})},$=[{title:"Имя"},{title:"Приход, ₽"},{title:"Расход, ₽"}],N=({sx:e,...s})=>{const{data:n,loading:r}=W();return r?t.jsx(G,{count:3}):j(n)?t.jsx(b,{}):t.jsxs(i,{sx:{mt:2,flexGrow:1,overflow:"auto",...e},...s,children:[t.jsx(i,{sx:{display:"flex",px:2,pb:2},children:$.map(({title:o},a)=>t.jsx(l,{variant:"body1",fontWeight:"bold",sx:{flex:1,textAlign:a===0?"left":"center"},children:o},o))}),t.jsx(y,{children:n?.map(({id:o,name:a,totalInflowAmount:d,totalOutflowAmount:x})=>t.jsxs(w,{children:[t.jsx(l,{variant:"body1",sx:{flex:1,textAlign:"left"},children:a}),t.jsx(i,{sx:{flex:1,display:"flex",justifyContent:"center"},children:t.jsx(F,{id:o,amount:d})}),t.jsx(i,{sx:{flex:1,display:"flex",justifyContent:"center"},children:t.jsx(_,{id:o,amount:-x})})]},o))})]})},V=()=>t.jsxs(L,{cardContentProps:{sx:{display:"flex",flexDirection:"column",flexShrink:0,py:1}},children:[t.jsx(l,{variant:"h4",children:"Статистика"}),t.jsx(N,{})]}),X=()=>t.jsxs(M,{display:"flex",flex:1,gap:2,overflow:"hidden",children:[t.jsxs(i,{display:"flex",gap:1,children:[t.jsx(f,{component:h,to:"../inflow",variant:"outlined",label:"Добавить приход",icon:"AddIcon",sx:{flex:1}}),t.jsx(f,{component:h,to:"../outflow",variant:"outlined",label:"Добавить расход",icon:"AddIcon",sx:{flex:1}})]}),t.jsx(V,{})]}),te=()=>t.jsx(X,{});export{te as HomePage};
